"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"createDatabase",value:function(){return idb.open("restaurants",2,function(e){switch(e.oldVersion){case 0:case 1:console.log("Creating the restaurants object store"),e.createObjectStore("restaurants",{keyPath:"id"});case 2:console.log("Creating the reviews object store"),e.createObjectStore("reviews",{keyPath:"id"})}})}},{key:"addRestaurantsToDB",value:function(n){return a.createDatabase().then(function(e){if(e){var t=e.transaction("restaurants","readwrite").objectStore("restaurants");return Promise.all(n.map(function(e){return console.log("adding restaurants to database"),t.put(e)}))}}).catch(function(e){tx.abort(),console.error(e)})}},{key:"fetchRestaurantsFromDB",value:function(){return a.createDatabase().then(function(e){return e.transaction("restaurants","readonly").objectStore("restaurants").getAll()})}},{key:"addReviewsToDB",value:function(n){return a.createDatabase().then(function(e){if(e){var t=e.transaction("reviews","readwrite").objectStore("reviews");return Promise.all(n.map(function(e){return console.log("adding reviews to database"),t.put(e)}))}}).catch(function(e){tx.abort(),console.error(e)})}},{key:"fetchReviewsFromDB",value:function(){return a.createDatabase().then(function(e){return e.transaction("reviews","readonly").objectStore("reviews").getAll()})}},{key:"logError",value:function(e){console.error(e)}},{key:"validateJSON",value:function(e){if(!e.ok)throw Error(e.statusText);return e.json()}},{key:"defineRestaurants",value:function(e){return e}},{key:"fetchRestaurantsFromNetwork",value:function(){return fetch(a.DATABASE_URL+"/restaurants").then(a.validateJSON).then(a.defineRestaurants)}},{key:"fetchRestaurants",value:function(){return a.fetchRestaurantsFromDB().then(function(e){return 0===e.length?a.fetchRestaurantsFromNetwork().then(function(e){return a.addRestaurantsToDB(e),e}).catch(a.logError):e})}},{key:"fetchReviewsByIdFromNetwork",value:function(e){return fetch(a.DATABASE_URL+"/reviews/?restaurant_id="+e).then(a.validateJSON).then(function(e){return e})}},{key:"fetchReviewsById",value:function(t){return a.fetchReviewsFromDB().then(function(e){return 0===e.length?a.fetchReviewsByIdFromNetwork(t).then(function(e){return a.addReviewsToDB(e),e}).catch(a.logError):e})}},{key:"fetchRestaurantById",value:function(e){return fetch(a.DATABASE_URL+"/restaurants/"+e).then(a.validateJSON).then(function(e){return e})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(e){var t=e;return"all"!=n&&(t=t.filter(function(e){return e.cuisine_type==n})),"all"!=r&&(t=t.filter(function(e){return e.neighborhood==r})),t})}},{key:"fetchNeighborhoods",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].neighborhood});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"fetchCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(e,t){return n[t].cuisine_type});return r.filter(function(e,t){return r.indexOf(e)==t})})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"img/"+e.id+"-600.jpg"}},{key:"srcsetForRestaurant",value:function(e){return"img/webp/"+e.id+"-400.webp 400w,\n      img/webp/"+e.id+"-600.webp 600w,\n      img/webp/"+e.id+"-800.webp 800w"}},{key:"addScript",value:function(){var e=document.body,t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSQXjgi1K6hqDS4W3nWVK_z0lntlbLFPo&libraries=places&callback=initMap",e.appendChild(t)}},{key:"toggleMap",value:function(e,t){var n=document.getElementById(e),r=document.getElementById(t);n.addEventListener("click",function(e){e.preventDefault(),r&&(r.classList.toggle("is-visible"),window.google||a.addScript())},!1)}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:a.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),a}();
//# sourceMappingURL=dbhelper.js.map
