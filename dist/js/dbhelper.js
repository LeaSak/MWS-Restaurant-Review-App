"use strict";var _createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"createDatabase",value:function(){return idb.open("restaurants",2,function(t){switch(t.oldVersion){case 0:case 1:console.log("Creating the restaurants object store"),t.createObjectStore("restaurants",{keyPath:"id"})}})}},{key:"addRestaurantsToDB",value:function(n){return a.createDatabase().then(function(t){if(t){var e=t.transaction("restaurants","readwrite").objectStore("restaurants");return Promise.all(n.map(function(t){return console.log("adding restaurants to database"),e.put(t)}))}}).catch(function(t){tx.abort(),console.error(t)})}},{key:"fetchRestaurantsFromDB",value:function(){return a.createDatabase().then(function(t){var e=t.transaction("restaurants","readonly").objectStore("restaurants");return console.log("fetching restaurants from database"),e.getAll()})}},{key:"logError",value:function(t){console.error(t)}},{key:"validateJSON",value:function(t){if(!t.ok)throw Error(t.statusText);return t.json()}},{key:"defineRestaurants",value:function(t){return t}},{key:"fetchRestaurantsFromNetwork",value:function(){return fetch(a.DATABASE_URL).then(a.validateJSON).then(a.defineRestaurants)}},{key:"fetchRestaurants",value:function(){return console.log("calling fetchRestaurants"),a.fetchRestaurantsFromDB().then(function(t){return 0===t.length?a.fetchRestaurantsFromNetwork().then(function(t){return a.addRestaurantsToDB(t),t}).catch(a.logError):t})}},{key:"fetchRestaurantById",value:function(n){return a.fetchRestaurants().then(function(t){var e=t.find(function(t){return t.id==n});if(e)return e})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,r){return a.fetchRestaurants().then(function(t){var e=t;return"all"!=n&&(e=e.filter(function(t){return t.cuisine_type==n})),"all"!=r&&(e=e.filter(function(t){return t.neighborhood==r})),e})}},{key:"fetchNeighborhoods",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(t,e){return n[e].neighborhood});return r.filter(function(t,e){return r.indexOf(t)==e})})}},{key:"fetchCuisines",value:function(){return a.fetchRestaurants().then(function(n){var r=n.map(function(t,e){return n[e].cuisine_type});return r.filter(function(t,e){return r.indexOf(t)==e})})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"img/"+t.id+"-600.webp"}},{key:"srcsetForRestaurant",value:function(t){return"img/"+t.id+"-400.webp 400w, \n      img/"+t.id+"-600.webp 600w, \n      img/"+t.id+"-800.webp 800w,\n      img/"+t.id+"-1200.webp 1200w,\n      img/"+t.id+"-1500.webp 1500w,\n      img/"+t.id+"-2000.webp 2000w"}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:a.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),a}();
//# sourceMappingURL=dbhelper.js.map
